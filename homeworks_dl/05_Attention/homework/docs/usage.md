# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é HW03 Transformer Summarization

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–¥–µ–ª—å Transformer –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ —Ä—É—Å—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤. –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ —Ç–µ–∫—Å—Ç–∞–º –Ω–æ–≤–æ—Å—Ç–µ–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ homework.md              # –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
‚îú‚îÄ‚îÄ todo.md                 # –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ seminar_code_from_ipynb.py  # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å–µ–º–∏–Ω–∞—Ä–∞ (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ Makefile               # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ dvc.yaml              # DVC –ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ news.csv              # –î–∞—Ç–∞—Å–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ src/                  # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ data.py          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ model.py         # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Transformer
‚îÇ   ‚îú‚îÄ‚îÄ train.py         # –û–±—É—á–µ–Ω–∏–µ —Å Label Smoothing
‚îÇ   ‚îî‚îÄ‚îÄ evaluate.py      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ü–µ–Ω–∫–∞
‚îú‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_dataset.py
‚îÇ   ‚îú‚îÄ‚îÄ test_pipeline.py
‚îÇ   ‚îú‚îÄ‚îÄ test_metrics.py
‚îÇ   ‚îî‚îÄ‚îÄ test_loss.py
‚îî‚îÄ‚îÄ docs/               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ usage.md
    ‚îî‚îÄ‚îÄ attention_examples/  # –ü—Ä–∏–º–µ—Ä—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
source .venv/bin/activate
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
make install
# –∏–ª–∏
pip install -r requirements.txt
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω

–ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –æ–±—É—á–µ–Ω–∏–µ ‚Üí –æ—Ü–µ–Ω–∫–∞):

```bash
make pipeline
```

### –ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

#### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
make preprocess
# –∏–ª–∏
python src/data.py
```

#### 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

```bash
make train
# –∏–ª–∏
python src/train.py
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- `best_model.pt` - –≤–µ—Å–∞ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
- `training_plot.png` - –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è

#### 3. –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏

```bash
make evaluate
# –∏–ª–∏
python src/evaluate.py
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- `predictions_on_test.txt` - –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
- `docs/attention_examples/` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è
- ROUGE –º–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
make test
# –∏–ª–∏
python -m pytest tests/ -v
```

### DVC –ø–∞–π–ø–ª–∞–π–Ω

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC:

```bash
make dvc-init
```

–ó–∞–ø—É—Å–∫ DVC –ø–∞–π–ø–ª–∞–π–Ω–∞:

```bash
make dvc-repro
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å TensorBoard

### –ó–∞–ø—É—Å–∫ TensorBoard —Å–µ—Ä–≤–µ—Ä–∞

```bash
make tensorboard
```

–ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:6006

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ TensorBoard

**–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è (`src/train.py`):**
- `Loss/train_epoch` - –ø–æ—Ç–µ—Ä–∏ –Ω–∞ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ –ø–æ —ç–ø–æ—Ö–∞–º
- `Loss/val_epoch` - –ø–æ—Ç–µ—Ä–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ –ø–æ —ç–ø–æ—Ö–∞–º  
- `Loss/train_batch` - –ø–æ—Ç–µ—Ä–∏ –ø–æ –±–∞—Ç—á–∞–º (–∫–∞–∂–¥—ã–µ 100 –±–∞—Ç—á–µ–π)
- `ROUGE/train_rouge1`, `ROUGE/train_rouge2`, `ROUGE/train_rougeL` - ROUGE –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏
- `ROUGE/val_rouge1`, `ROUGE/val_rouge2`, `ROUGE/val_rougeL` - ROUGE –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `Learning_Rate` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ learning rate –ø–æ —à–∞–≥–∞–º
- `Parameters/*` - –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –≤–µ—Å–æ–≤ –º–æ–¥–µ–ª–∏ (–∫–∞–∂–¥—ã–µ 5 —ç–ø–æ—Ö)
- `Gradients/*` - –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 5 —ç–ø–æ—Ö)
- –ì—Ä–∞—Ñ –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–í–æ –≤—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∏ (`src/evaluate.py`):**
- `Evaluation/ROUGE-1`, `Evaluation/ROUGE-2`, `Evaluation/ROUGE-L` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ ROUGE –º–µ—Ç—Ä–∏–∫–∏
- `Example_*/Source`, `Example_*/Reference`, `Example_*/Generated` - –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–æ–≤
- `Custom_Example_*/Source`, `Custom_Example_*/Generated` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

```
runs/
‚îú‚îÄ‚îÄ transformer_summarization_YYYYMMDD_HHMMSS/  # –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ evaluation_YYYYMMDD_HHMMSS/                 # –õ–æ–≥–∏ –æ—Ü–µ–Ω–∫–∏
‚îî‚îÄ‚îÄ custom_examples_YYYYMMDD_HHMMSS/             # –õ–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
```

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `generate_summary()` –≤ `src/evaluate.py`
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ 5 –ø—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ —Ç–µ—Å—Ç–∞
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ 5 —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö

### –ó–∞–¥–∞–Ω–∏–µ 2: ROUGE –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `rouge_scorer.RougeScorer`
- ‚úÖ –†–∞—Å—á–µ—Ç ROUGE –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
- ‚úÖ –†–∞—Å—á–µ—Ç ROUGE –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ

### –ó–∞–¥–∞–Ω–∏–µ 3: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü attention
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `plot_attention()` –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è 3 —Å–ª—É—á–∞–µ–≤ –≤ `docs/attention_examples/`

### –ó–∞–¥–∞–Ω–∏–µ 4: –û–±—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- ‚úÖ –ö–ª–∞—Å—Å `SharedEmbeddings`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —ç–Ω–∫–æ–¥–µ—Ä–µ, –¥–µ–∫–æ–¥–µ—Ä–µ –∏ –≤—ã—Ö–æ–¥–Ω–æ–º —Å–ª–æ–µ
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –≤–µ—Å–æ–≤ (weight tying)

### –ó–∞–¥–∞–Ω–∏–µ 5: Label Smoothing
- ‚úÖ –ö–ª–∞—Å—Å `LabelSmoothingLoss`
- ‚úÖ –ó–∞–º–µ–Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ NLL Loss
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏

### –ó–∞–¥–∞–Ω–∏–µ 6: –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç MCP context7)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏

–ú–æ–¥–µ–ª—å –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Transformer:

- **–≠–Ω–∫–æ–¥–µ—Ä**: 4 —Å–ª–æ—è, 8 –≥–æ–ª–æ–≤ –≤–Ω–∏–º–∞–Ω–∏—è
- **–î–µ–∫–æ–¥–µ—Ä**: 4 —Å–ª–æ—è, 8 –≥–æ–ª–æ–≤ –≤–Ω–∏–º–∞–Ω–∏—è  
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏**: 256
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å FFN**: 1024
- **–û–±—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏**: –¥–ª—è —ç–Ω–∫–æ–¥–µ—Ä–∞, –¥–µ–∫–æ–¥–µ—Ä–∞ –∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Å–ª–æ—è

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **Label Smoothing**: –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç–æ–∫ —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º 0.1
2. **Noam Optimizer**: –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ learning rate
3. **ROUGE –º–µ—Ç—Ä–∏–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
4. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è**: Heatmap –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–Ω–∏–º–∞–Ω–∏—è
5. **–û–±—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏**: –≠–∫–æ–Ω–æ–º–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –æ–±–æ–±—â–µ–Ω–∏—è

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã:

- `best_model.pt` - –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏
- `training_plot.png` - –≥—Ä–∞—Ñ–∏–∫–∏ loss –∏ ROUGE –º–µ—Ç—Ä–∏–∫
- `predictions_on_test.txt` - –ø—Ä–∏–º–µ—Ä—ã —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
- `docs/attention_examples/` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è

## –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è —Å–¥–∞—á–∏

```bash
make package
```

–°–æ–∑–¥–∞–µ—Ç –∞—Ä—Ö–∏–≤ `BorovetsNV-hw03.zip` —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

- Python 3.11+
- PyTorch 1.9+
- 8GB+ RAM –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- GPU/MPS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è 

## –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ pipeline —á–µ—Ä–µ–∑ DVC

```bash
dvc repro
```

–≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ —ç—Ç–∞–ø—ã:
1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`data.py`)
2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (`train.py`)
3. –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ (`evaluate.py`)

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
python -m src.data
```

### 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å —á–µ–∫–ø–æ–∏–Ω—Ç–∞–º–∏
```bash
# –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ (10 —ç–ø–æ—Ö)
python -m src.train

# –û–±—É—á–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python -m src.train --epochs 20 --early-stopping 5

# –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–ø–æ–∏–Ω—Ç—ã)
python -m src.train --no-resume

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–ª—É—á–∞–π–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
python -m src.train --no-pretrained

# –°–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ–∫–ø–æ–∏–Ω—Ç –∫–∞–∂–¥—ã–µ 2 —ç–ø–æ—Ö–∏
python -m src.train --save-every 2

# –£–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
python -m src.train --checkpoint-dir my_checkpoints
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è

- `--epochs N`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `--no-resume`: –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —á–µ–∫–ø–æ–∏–Ω—Ç—ã
- `--checkpoint-dir DIR`: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `checkpoints`)
- `--save-every N`: –°–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ–∫–ø–æ–∏–Ω—Ç –∫–∞–∂–¥—ã–µ N —ç–ø–æ—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `--early-stopping N`: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π N —ç–ø–æ—Ö
- `--no-pretrained`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

### 3. –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏
```bash
python -m src.evaluate
```

## –ú–µ—Ö–∞–Ω–∏–∑–º —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –ß–µ–∫–ø–æ–∏–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è `--save-every`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `latest_checkpoint.pth` - –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–µ–∫–ø–æ–∏–Ω—Ç
- –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å –ø–æ validation loss —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `best_model.pth`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `python -m src.train` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–µ–∫–ø–æ–∏–Ω—Ç
- –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞, learning rate scheduler, –∏—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–µ–∫–ø–æ–∏–Ω—Ç–∞
```python
{
    'epoch': 5,                           # –ù–æ–º–µ—Ä —ç–ø–æ—Ö–∏
    'model_state_dict': model.state_dict(), # –í–µ—Å–∞ –º–æ–¥–µ–ª–∏
    'optimizer_state_dict': optimizer.state_dict(), # –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞  
    'optimizer_step': 1500,               # –®–∞–≥ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ NoamOpt
    'optimizer_rate': 0.0001,             # –¢–µ–∫—É—â–∏–π learning rate
    'history': {...},                     # –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è (losses, ROUGE)
    'timestamp': '2024-01-15T10:30:00'    # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫–ø–æ–∏–Ω—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ —á–µ–∫–ø–æ–∏–Ω—Ç—ã (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3)
- `latest_checkpoint.pth` –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π —á–µ–∫–ø–æ–∏–Ω—Ç
- `best_model.pth` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–æ–¥–µ–ª—å —Å –ª—É—á—à–∏–º validation loss

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ 50 —ç–ø–æ—Ö
python -m src.train --epochs 50

# –ï—Å–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–ª–æ—Å—å, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:
python -m src.train --epochs 50
# –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å
```

**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:**
```bash
# –ü–µ—Ä–≤—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç
python -m src.train --epochs 10 --checkpoint-dir exp1

# –í—Ç–æ—Ä–æ–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç  
python -m src.train --epochs 10 --checkpoint-dir exp2 --no-pretrained

# –í–æ–∑–≤—Ä–∞—Ç –∫ –ø–µ—Ä–≤–æ–º—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É
python -m src.train --epochs 20 --checkpoint-dir exp1
```

**Early stopping:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π 5 —ç–ø–æ—Ö –ø–æ–¥—Ä—è–¥
python -m src.train --epochs 100 --early-stopping 5
```

## –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–ó–∞–¥–∞–Ω–∏–µ 6)

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö —Ä—É—Å—Å–∫–∏—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ FastText:

### –ó–∞–≥—Ä—É–∑–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
```bash
python -m src.embeddings.download_embeddings
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª `src/embeddings/cc.ru.300.bin`, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
```bash
python -m src.train --no-pretrained
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

### TensorBoard
```bash
# –ó–∞–ø—É—Å–∫ TensorBoard (–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ runs/)
tensorboard --logdir runs

# –û—Ç–∫—Ä—ã—Ç—å http://localhost:6006 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

–í TensorBoard –¥–æ—Å—Ç—É–ø–Ω—ã:
- –ì—Ä–∞—Ñ–∏–∫–∏ loss –ø–æ —ç–ø–æ—Ö–∞–º –∏ –±–∞—Ç—á–∞–º
- ROUGE –º–µ—Ç—Ä–∏–∫–∏
- Learning rate schedule
- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –≤–µ—Å–æ–≤ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ –º–æ–¥–µ–ª–∏
- –ì—Ä–∞—Ñ –º–æ–¥–µ–ª–∏

### –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã:
- `best_model_*.pt` - –≤–µ—Å–∞ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
- `training_plot_*.png` - –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è  
- `model_info_*.json` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- `checkpoints/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —á–µ–∫–ø–æ–∏–Ω—Ç–∞–º–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
python -m pytest tests/test_pipeline.py::test_checkpoint_functionality -v
```

## –ó–∞–¥–∞–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ 6 –∑–∞–¥–∞–Ω–∏–π:

1. ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏** - —Ñ—É–Ω–∫—Ü–∏—è `generate_summary()` –≤ `evaluate.py`
2. ‚úÖ **ROUGE-–º–µ—Ç—Ä–∏–∫–∞** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ–±—É—á–µ–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫—É
3. ‚úÖ **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è** - —Ñ—É–Ω–∫—Ü–∏—è `plot_attention()` –≤ `evaluate.py`  
4. ‚úÖ **–û–±—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏** - –∫–ª–∞—Å—Å `SharedEmbeddings` –≤ `model.py`
5. ‚úÖ **Label Smoothing Loss** - –∫–ª–∞—Å—Å `LabelSmoothingLoss` –≤ `train.py`
6. ‚úÖ **–ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FastText

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤** - –ø–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è
- ‚úÖ **Early stopping** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–∏  
- ‚úÖ **TensorBoard –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - mps ‚Üí cuda ‚Üí cpu
- ‚úÖ **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - 48 unit-—Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ 